<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GreenPledge - Reward Shop</title>
  <meta name="description" content="Redeem your XP for eco-friendly rewards at the GreenPledge Reward Shop.">
  <meta name="keywords" content="sustainability, eco-friendly, rewards, green living, environment">
  <meta name="author" content="GreenPledge Team">
  <script defer src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;700&display=swap');
    
    :root {
      --primary: #10b981;
      --primary-dark: #059669;
      --secondary: #f59e0b;
      --accent: #34d399;
      --background: #f0fdf4;
      --text: #1f2937;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);
      min-height: 100vh;
      margin: 0;
      overflow-x: hidden;
      color: var(--text);
    }

    h1, h2, h3, h4, h5, h6 {
      font-family: 'Playfair Display', serif;
    }

    .glassmorphism {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px rgba(31, 38, 135, 0.1);
    }

    @supports not (backdrop-filter: blur(15px)) {
      .glassmorphism {
        background: rgba(255, 255, 255, 0.3);
      }
    }

    .card-3d {
      transition: transform 0.5s ease, box-shadow 0.5s ease;
      transform: perspective(1000px) rotateX(0deg) rotateY(0deg);
    }

    .card-3d:hover {
      transform: perspective(1000px) rotateX(5deg) rotateY(-5deg);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    }

    .glow-btn {
      position: relative;
      overflow: hidden;
      z-index: 1;
    }

    .glow-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.5s ease;
      z-index: -1;
    }

    .glow-btn:hover::before {
      left: 100%;
    }

    .fade-in {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.8s ease, transform 0.8s ease;
    }

    .fade-in.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .nav-logo-text {
      color: #1f2937 !important;
    }

    .nav-icon {
      color: #10b981 !important;
    }

    nav {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 100;
      transition: background-color 0.3s ease;
    }

    nav.scrolled {
      /* Glassmorphism applied on scroll */
    }

    /* Table Styling */
    .rewards-table-container {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    th, td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid #e5e7eb;
    }

    th {
      background-color: #10b981;
      color: white;
      font-weight: 600;
      white-space: nowrap;
    }

    td {
      background-color: rgba(255, 255, 255, 0.8);
    }

    .redeem-btn {
      background-color: #10b981;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      transition: background-color 0.3s ease;
      font-size: 0.875rem;
      min-width: 80px;
      text-align: center;
    }

    .redeem-btn:hover {
      background-color: #059669;
    }

    .redeem-btn:disabled {
      background-color: #d1d5db;
      cursor: not-allowed;
      opacity: 0.6;
    }

    /* Responsive Adjustments */
    @media (max-width: 640px) {
      /* Stack table rows for mobile */
      table {
        display: block;
      }

      thead {
        display: none; /* Hide table headers on mobile */
      }

      tr {
        display: block;
        margin-bottom: 1rem;
        border-bottom: 2px solid #e5e7eb;
      }

      td {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.5rem;
        border-bottom: none;
        background-color: rgba(255, 255, 255, 0.9);
      }

      td:before {
        content: attr(data-label);
        font-weight: 600;
        color: #1f2937;
        flex: 1;
        margin-right: 1rem;
      }

      td:last-child {
        border-bottom: none;
      }

      .redeem-btn {
        padding: 0.5rem;
        font-size: 0.875rem;
        min-width: 90px;
      }

      /* Adjust section padding and font sizes */
      section {
        padding-top: 5rem; /* Account for fixed nav */
        padding-bottom: 2rem;
      }

      h1 {
        font-size: 2rem;
      }

      h3 {
        font-size: 1.25rem;
      }

      .p-8 {
        padding: 1.5rem;
      }

      .max-w-4xl {
        max-width: 100%;
        padding-left: 1rem;
        padding-right: 1rem;
      }

      /* Adjust navigation button */
      nav .flex.items-center.space-x-3 a {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
      }
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="fixed top-0 left-0 w-full z-[100] transition-all duration-300" aria-label="Main navigation">
    <div class="max-w-7xl mx-auto px-6">
      <div class="flex items-center justify-between h-20">
        <div class="flex items-center">
          <i class="fas fa-leaf text-2xl text-emerald-300 mr-2 nav-icon"></i>
          <span class="text-xl font-bold text-white nav-logo-text">GreenPledge</span>
        </div>
        <div class="flex items-center space-x-3">
          <a href="index.html" class="px-5 py-2 text-emerald-300 hover:text-white border border-emerald-300/50 rounded-full font-medium hover:bg-emerald-600/30 transition">
            Back to Home
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Rewards Section -->
  <section class="max-w-4xl mx-auto mb-20 py-32">
    <div class="glassmorphism card-3d rounded-2xl overflow-hidden fade-in">
      <div class="p-8 md:p-10">
        <h1 class="text-4xl font-bold text-gray-800 mb-6 text-center">Reward Shop</h1>
        <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
          <h3 class="text-xl font-semibold text-gray-800">Your XP: <span id="user-xp">0</span></h3>
          <button id="refresh-xp" class="glow-btn px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
            <i class="fas fa-sync-alt mr-2"></i> Refresh XP
          </button>
        </div>
        <div class="rewards-table-container">
          <table>
            <thead>
              <tr>
                <th>Reward</th>
                <th>Points Required</th>
                <th>Description</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td data-label="Reward">Digital Certificate</td>
                <td data-label="Points Required">50 points</td>
                <td data-label="Description">Personalized certificate of eco-achievement (PDF format).</td>
                <td data-label="Action">
                  <button class="redeem-btn" data-points="50" data-reward="Digital Certificate">Redeem</button>
                </td>
              </tr>
              <tr>
                <td data-label="Reward">Reusable Cloth Bag</td>
                <td data-label="Points Required">100 points</td>
                <td data-label="Description">Eco-friendly bag with GreenPledge logo, ideal for shopping.</td>
                <td data-label="Action">
                  <button class="redeem-btn" data-points="100" data-reward="Reusable Cloth Bag">Redeem</button>
                </td>
              </tr>
              <tr>
                <td data-label="Reward">GreenPledge Badge (Physical)</td>
                <td data-label="Points Required">300 points</td>
                <td data-label="Description">A collectible badge mailed to them to show off their commitment.</td>
                <td data-label="Action">
                  <button class="redeem-btn" data-points="300" data-reward="GreenPledge Badge">Redeem</button>
                </td>
              </tr>
              <tr>
                <td data-label="Reward">T-shirt (GreenPledge Edition)</td>
                <td data-label="Points Required">400 points</td>
                <td data-label="Description">A stylish, organic cotton T-shirt with our message and logo.</td>
                <td data-label="Action">
                  <button class="redeem-btn" data-points="400" data-reward="T-shirt (GreenPledge Edition)">Redeem</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

  <script type="module">
    import { getXP, saveXP } from './dataManager.js';

    // DOM Elements
    const userXP = document.getElementById('user-xp');
    const refreshXPButton = document.getElementById('refresh-xp');
    const redeemButtons = document.querySelectorAll('.redeem-btn');

    // Initialize the page
    function initRewardsPage() {
      updateXP();
      setupEventListeners();
      setupScrollAnimations();
    }

    // Update XP display
    function updateXP() {
      const xp = getXP();
      userXP.textContent = xp;
      updateRedeemButtons(xp);
    }

    // Update redeem buttons based on XP
    function updateRedeemButtons(xp) {
      redeemButtons.forEach(button => {
        const pointsRequired = parseInt(button.getAttribute('data-points'));
        button.disabled = xp < pointsRequired;
      });
    }

    // Scroll animations for sections
    function setupScrollAnimations() {
      const elements = document.querySelectorAll('.fade-in');
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
          }
        });
      }, { threshold: 0.2 });

      elements.forEach(element => observer.observe(element));
    }

    // Handle reward redemption
    function handleRedeem(e) {
      const button = e.target;
      const pointsRequired = parseInt(button.getAttribute('data-points'));
      const reward = button.getAttribute('data-reward');
      let currentXP = getXP();

      if (currentXP < pointsRequired) {
        alert("You don't have enough XP to redeem this reward!");
        return;
      }

      // Deduct XP
      currentXP -= pointsRequired;
      saveXP(currentXP);
      updateXP();

      // Simulate reward redemption (in a real app, this would involve backend integration)
      alert(`Congratulations! You've redeemed a ${reward}. We'll process your reward soon! ðŸŒ±`);
      
      // Log the redemption (for analytics or future tracking)
      console.log(`User redeemed ${reward} for ${pointsRequired} XP`);
    }

    // Set up event listeners
    function setupEventListeners() {
      refreshXPButton.addEventListener('click', updateXP);

      redeemButtons.forEach(button => {
        button.addEventListener('click', handleRedeem);
      });

      // Update navigation background on scroll
      window.addEventListener('scroll', () => {
        const nav = document.querySelector('nav');
        if (window.scrollY > 50) {
          nav.classList.add('glassmorphism', 'scrolled');
        } else {
          nav.classList.remove('glassmorphism', 'scrolled');
        }
      });
    }

    // Initialize the page on load
    window.addEventListener('DOMContentLoaded', initRewardsPage);
  </script>
</body>
</html>
